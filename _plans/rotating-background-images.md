# Plan: Random Background Images for Jekyll Site

## Notes

_The actual implementation varied from this plan - I moved everything to a Rakefile rather than a Jekyll plugin due to GitHub restrictions_

## Context

The user wants to add a random background image feature to their Jekyll blog. The site currently has 165 JPEG images in `assets/backgrounds/` that should be randomly selected and displayed as the page background. The requirement is to create a Jekyll plugin/hook that runs during the build process to generate a list of available images, then use JavaScript to randomly select and apply one of these images on every page load. The background should cover the full viewport while maintaining aspect ratio.

This feature will add visual variety to the site, with each page load/reload showing a different background image from the user's personal photography collection.

## Implementation Approach

**Chosen Strategy: Jekyll Generator Plugin + Generated JavaScript File**

This approach meets the "build process hook" requirement while maintaining clean separation between build-time logic (Ruby plugin) and runtime logic (JavaScript). The plugin scans the backgrounds directory during Jekyll build and generates a JavaScript file containing an array of all image paths. Client-side JavaScript then randomly selects from this array on page load.

### Why This Approach

1. **True Jekyll hook** - Uses Jekyll's Generator hook during build process
2. **Automatic maintenance** - Adding/removing images requires no manual code updates
3. **GitHub Pages compatible** - Generated JS file can be committed for deployment
4. **Optimal performance** - Array generation happens at build time, not runtime
5. **Browser cacheable** - The generated JS file benefits from caching

## Implementation Steps

### Step 1: Create Jekyll Plugin

**File:** `_plugins/background_images.rb`

Create a Jekyll Generator that:
- Runs during site generation (after site files are read)
- Scans `assets/backgrounds/` for all `.jpeg` files
- Sorts filenames alphabetically for consistency
- Generates a JavaScript file at `assets/js/backgrounds.js`
- The JS file exports a global array `BACKGROUND_IMAGES` with relative paths

**Key implementation:**
```ruby
module Jekyll
  class BackgroundImagesGenerator < Generator
    safe true
    priority :low

    def generate(site)
      backgrounds_dir = File.join(site.source, 'assets', 'backgrounds')
      return unless File.directory?(backgrounds_dir)

      # Scan for JPEG files
      image_files = Dir.glob(File.join(backgrounds_dir, '*.jpeg'))
                       .map { |f| "/assets/backgrounds/#{File.basename(f)}" }
                       .sort

      # Generate JavaScript with array
      js_content = "// Auto-generated by Jekyll plugin\n"
      js_content += "// Generated at: #{Time.now}\n"
      js_content += "var BACKGROUND_IMAGES = #{image_files.to_json};\n"

      # Write to assets/js/backgrounds.js
      output_dir = File.join(site.source, 'assets', 'js')
      FileUtils.mkdir_p(output_dir)
      File.write(File.join(output_dir, 'backgrounds.js'), js_content)
    end
  end
end
```

### Step 2: Override Theme's head.html

**File:** `_includes/head.html`

Copy the minima theme's head.html from:
`/Users/natewiger/.rbenv/versions/3.4.7/lib/ruby/gems/3.4.0/gems/minima-2.5.1/_includes/head.html`

Then add before the closing `</head>` tag:

```html
<!-- Random background images -->
<link rel="stylesheet" href="{{ "/assets/css/background.css" | relative_url }}">
<script src="{{ "/assets/js/backgrounds.js" | relative_url }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof BACKGROUND_IMAGES !== 'undefined' && BACKGROUND_IMAGES.length > 0) {
      var randomIndex = Math.floor(Math.random() * BACKGROUND_IMAGES.length);
      var selectedImage = BACKGROUND_IMAGES[randomIndex];
      document.body.style.backgroundImage = 'url("' + selectedImage + '")';
      document.body.classList.add('has-random-background');
    }
  });
</script>
```

**Why DOMContentLoaded:** Ensures the body element exists before applying styles, preventing errors and FOUC.

### Step 3: Create Background CSS

**File:** `assets/css/background.css`

```css
/* Random background image styling */
body.has-random-background {
  background-size: cover;           /* Scale to cover viewport, maintaining aspect ratio */
  background-position: center center; /* Center the image */
  background-repeat: no-repeat;     /* No tiling */
  background-attachment: fixed;     /* Parallax effect - stays fixed while scrolling */
  min-height: 100vh;                /* Ensure full viewport height */
}

/* Ensure content remains readable over background */
.page-content {
  background-color: rgba(255, 255, 255, 0.95); /* Semi-transparent white */
  padding: 20px;
  margin: 20px auto;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Optional: Remove background on very small screens for performance */
@media (max-width: 480px) {
  body.has-random-background {
    background-attachment: scroll; /* Better mobile performance */
  }
}
```

**CSS Properties Explained:**
- `background-size: cover` - Ensures image covers 100% of viewport while maintaining aspect ratio (may crop edges)
- `background-position: center` - Centers the image both horizontally and vertically
- `background-attachment: fixed` - Creates parallax effect where background stays in place during scroll
- Semi-transparent content wrapper ensures text readability regardless of background image

### Step 4: Create Required Directories

```bash
mkdir -p _plugins
mkdir -p _includes
mkdir -p assets/js
mkdir -p assets/css
```

## Critical Files

- **`_plugins/background_images.rb`** - Jekyll Generator plugin that scans `assets/backgrounds/` during build and generates `assets/js/backgrounds.js` with array of image paths

- **`_includes/head.html`** - Override of minima theme's head template to inject background selection JavaScript on every page

- **`assets/css/background.css`** - Styling for background image (cover, center, fixed) and content wrapper transparency

- **`assets/js/backgrounds.js`** (generated) - Auto-generated JavaScript file containing array of 165 background image paths

- **`/Users/natewiger/.rbenv/versions/3.4.7/lib/ruby/gems/3.4.0/gems/minima-2.5.1/_includes/head.html`** - Source template to copy for creating the head.html override

## Verification

### Build Verification

1. **Run Jekyll build:**
   ```bash
   cd /Users/natewiger/Workspace/nateware.github.io
   bundle exec jekyll build
   ```

2. **Verify generated file:**
   ```bash
   cat assets/js/backgrounds.js
   ```
   Should show a JavaScript file with `var BACKGROUND_IMAGES = [...]` containing 165 paths

3. **Check array contents:**
   - Should have paths like `/assets/backgrounds/img_0023.jpeg`
   - Should be sorted alphabetically
   - Should include all JPEG files from the directory

### Local Testing

1. **Start Jekyll server:**
   ```bash
   bundle exec jekyll serve
   ```

2. **Visit http://localhost:4000**
   - Background image should appear covering full viewport
   - Content should be readable with semi-transparent wrapper

3. **Test randomness:**
   - Reload page 5-10 times
   - Verify different background images appear each time
   - Test on different page types (home, posts, pages)

4. **Test responsiveness:**
   - Resize browser window
   - Check mobile viewport sizes
   - Verify background scales properly while maintaining aspect ratio

5. **Check browser console:**
   - Should have no JavaScript errors
   - Can verify selected image with: `console.log(document.body.style.backgroundImage)`

### Visual Verification

- [ ] Background covers entire viewport (no gaps)
- [ ] Aspect ratio is maintained (no distortion)
- [ ] Content is readable over all background images
- [ ] Background changes on each reload
- [ ] No flash of unstyled content (FOUC)
- [ ] Smooth appearance on page load

## GitHub Pages Deployment Note

**Important:** GitHub Pages restricts custom plugins for security.

**Deployment strategy:**
1. Run `bundle exec jekyll build` locally before pushing
2. Commit the generated `assets/js/backgrounds.js` file to git
3. Push to GitHub - the site will use the pre-generated file
4. When adding/removing images, rebuild locally and commit updated backgrounds.js

**Alternative:** Set up GitHub Actions for custom builds (more complex, outside scope of this plan)

## Trade-offs

**Chosen approach benefits:**
- Clean separation: Jekyll handles generation, JavaScript handles selection
- Easy debugging: Can inspect `backgrounds.js` directly
- Browser caching: Generated file cached between visits
- Maintainable: Plugin is ~20 lines of clear Ruby code

**Considerations:**
- Extra HTTP request for backgrounds.js (mitigated by caching)
- Large image file sizes (4-7MB) may impact load time - consider optimization later
- Fixed background attachment may impact mobile performance (addressed with media query)
- Content wrapper styling may need adjustment based on specific images

## Future Enhancements (Optional)

1. **Session persistence** - Use sessionStorage to keep same background across page navigation
2. **Image optimization** - Create web-optimized versions of backgrounds
3. **Dark mode detection** - Choose lighter/darker images based on prefers-color-scheme
4. **Accessibility** - Add prefers-reduced-motion support to disable parallax effect
5. **Configuration** - Add `_config.yml` options to enable/disable or configure opacity
